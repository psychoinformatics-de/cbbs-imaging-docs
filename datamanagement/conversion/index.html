<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="author" content="Team Brawndo" />
  <title>CBBS Imaging &ndash; Raw Data Conversion</title>
  <link rel="license" hreflang="en" href="../../copyright.html" />

  <link rel="stylesheet" type="text/css" href="../../theme/css/style.css">
</head>

<body>
  <aside>
    <h1><a href="/">CBBS Imaging</a></h1>
    <nav>
      <ul>

              <li>
                <a href="../../datamanagement/">Data Management</a>

                <ul>
                  <li>
                    <a href="../../datamanagement/study_setup/">Initial study setup</a>
                  </li>
                  <li>
                    <a href="../../datamanagement/import_dicoms/">Import DICOMs</a>
                  </li>
                  <li>
                    <a href="../../datamanagement/import_other/">Import additional data</a>
                  </li>
                  <li>
                    <a href="../../datamanagement/study_specification/">Study specification</a>
                  </li>
                  <li>
                    <a class="active" href="../../datamanagement/conversion/">Raw Data Conversion</a>
<div id="toc"><ul><li><a class="toc-href" href="#dataset-creation" title="Dataset creation">Dataset creation</a></li><li><a class="toc-href" href="#reference-needed-input" title="Reference needed input">Reference needed input</a></li><li><a class="toc-href" href="#conversion" title="Conversion">Conversion</a></li><li><a class="toc-href" href="#dropping-raw-data" title="Dropping raw data">Dropping raw data</a></li></ul></div>                  </li>
                  <li>
                    <a href="../../datamanagement/tools/">Tools</a>
                  </li>
                  <li>
                    <a href="../../datamanagement/demo_scandb/">Demo: DICOM DB</a>
                  </li>
                </ul>
              </li>
              <li><a href="../../analysis/">Data Analysis</a></li>
              <li><a href="../../devices/">Acquisition Hardware</a></li>
              <li><a href="../../containers/">Computational Environments</a></li>
              <li><a href="../../contributing/">Contributing</a></li>
      </ul>
    </nav>
    <form class="searchbox" action="../../search.html">
      <input type="text" name="q" id="tipue_search_input" placeholder="Search">
    </form>
    <img src="../../theme/img/cbbs_logo.png" alt="CBBS Logo">
    <img src="../../theme/img/EFRE_logo.png"
         alt="Signets of Saxony-Anhalt and the European Regional Development Fund">
  </aside>

  <main>
    <div id='content'>
<article>
  <header>
    <nav>
      <ul class="breadcrumbs">
        <li><a href="../../">Home</a></li>
        <li> > <a href="../../datamanagement/">Data Management</a></li>
        <li> > Raw Data Conversion</li>
      </ul>
    </nav>
    <h1>Raw Data Conversion</h1>
  </header>

  <div>
    <p>The conversion of a <a class="reference external" href="../../datamanagement/study_setup/">study raw dataset</a> to a BIDS
compliant dataset relies on a proper <a class="reference external" href="../../datamanagement/study_specification/">specification</a>.
The outcome of such a conversion is again a datalad dataset. It contains a
reference to the study dataset it was build from, but can be used and shared
without access to the study dataset.</p>
<div class="section" id="dataset-creation">
<h2 id="dataset-creation">Dataset creation<a class="headerlink" href="#dataset-creation" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>First, create the to-be BIDS dataset pretty much the same way as you
<a class="reference external" href="{filename}study_dataset.rst">create a study dataset</a>:</p>
<pre class="literal-block">
datalad create [TARGET-DIR]
</pre>
<p>If you don't provide a target dir, the dataset will be created in the current
working directory. This will create an empty datalad dataset.</p>
<p>To preconfigure it to be a <em>BIDS dataset</em> however, you need to run a dedicated
setup procedure from within the dataset:</p>
<pre class="literal-block">
cd [TARGET-DIR]
datalad run-procedure setup_bids_dataset
</pre>
</div>
<div class="section" id="reference-needed-input">
<h2 id="reference-needed-input">Reference needed input<a class="headerlink" href="#reference-needed-input" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>In order to achieve reproducibility and link the exact environment that was used
for DICOM conversion run:</p>
<pre class="literal-block">
datalad containers-add conversion \
  -u shub://mih/ohbm2018-training:heudiconv \
  --call-fmt 'singularity exec --bind {{pwd}} {img} {cmd}'
</pre>
<p>Please note, that the recommended environment to be used will change soon, since
we will provide a toolbox dataset suited for this platform and its usage in
Magdeburg.</p>
<p>Now the study dataset to be converted is needed. Install it as a subdataset
<cite>sourcedata</cite> into the BIDS dataset:</p>
<pre class="literal-block">
datalad install -d . -s [PATH TO STUDY DATASET] sourcedata
</pre>
</div>
<div class="section" id="conversion">
<h2 id="conversion">Conversion<a class="headerlink" href="#conversion" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>Assuming that the study dataset comes with a proper study specification, you can
now convert it by calling:</p>
<pre class="literal-block">
datalad hirni-spec2bids --anonymize sourcedata/*/studyspec.json
</pre>
<p>Several things are to be noted here. First, there is a switch <tt class="docutils literal"><span class="pre">--anonymize</span></tt>.
This is optional and ensures that within the resulting BIDS dataset subjects are
referred to only by their <cite>anon_subject</cite> ID according to the specification.
There shouldn't be any hint on the original subject ID in the commit messages or
paths in the new dataset. What is <em>doesn't</em> do, however, is defacing the images.
This is an additional step to be taken, that requires the images to already be
converted.</p>
<p>Furthermore, you may notice that the call as shown above references not the
study dataset to be converted but the specification files. This means, you don't
need to convert the entire dataset at once. You can also convert a single
acquisition instead.</p>
</div>
<div class="section" id="dropping-raw-data">
<h2 id="dropping-raw-data">Dropping raw data<a class="headerlink" href="#dropping-raw-data" title="Permalink to this headline"><i class="icon-link"></i></a></h2>
<p>Finally, you can uninstall the source dataset by running:</p>
<pre class="literal-block">
datalad uninstall -d . -r --nocheck sourcedata
</pre>
<p>This will leave you with just the BIDS dataset. It still contains a reference to
the data it was derived from, but doesn't contain that data.</p>
</div>

  </div>
</article>
    </div>

    <footer>
      <p><small>
          Acknowledgment: funded by the federal state of Saxony-Anhalt and the "European Regional Development Fund" (ERDF 2014-2020), Project: Center for Behavioral Brain Sciences (CBBS), FKZ: ZS/2016/04/78113
      </small></p>
      <p><small>
        content licensed <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">cc-by-sa</a>
        <span class='break'>—</span> ©2017–2018 Team Brawndo <span class='break'>—</span>
        unless <a rel="license" href='../../copyright.html'>indicated otherwise</a>
      </small></p>
    </footer>
  </main>
</body>
</html>